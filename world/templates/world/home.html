{% extends "world/base.html" %}
{% block content %}
    {% load leaflet_tags %}
    {% load static %}
    {% load i18n %}
    {% load crispy_forms_tags %}
    {% load crispy_forms_filters %}
    <head>
        {% leaflet_js %}
        {% leaflet_css %}
        {% block head_title %}{% endblock %}
        {% block extra_header %}
            <style>
                #map {width: 80vw;height: 81vh;}
            </style>
        {% endblock %}

    </head>
    <body>
        {% block body_content %}
            {% for post in posts %}
                <article class="media content-section">
                    <div class="media-body">
                        <div class="article-metadata">
                            <a class="mr-2" href="#">{{ post.author }}</a>
                            <small class="text-muted">{{ post.date_posted|date:"F d, Y" }}</small>
                        </div>
                        <h2><a class="article-title" href="{% url 'post-detail' post.id %}">{{ post.title }}</a></h2>
                        <p class="article-content">{{ post.dream_holiday.name }}</p>
                        <p class="article-content">{{ post.reason }}</p>
                        <button class="btn btn-outline-info" onclick="updateLatLon('{{ post.dream_holiday.lat }}', '{{ post.dream_holiday.long }}')">View On Map</button>
                    </div>
                </article>
            {% endfor %}
            {% leaflet_map "map" callback="window.map_init_basic" %}
        {% endblock %}
    </body>
    {% block extra_footer %}

        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-autohide="false">
            <div class="toast-header">
                <strong class="mr-auto">AWM2021</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body"></div>
        </div>

        <script>
            $("#body_div").css({"top": $(".site-header").height() + 10, "position": "absolute"});
                $(".toast").css({
                    "top": ($(document).height() / 5),
                    "left": ($(document).width() / 5),
                    "position": "fixed",
                    "z-index": 2000
                });
        </script>

    <script>
        let HOST = location.protocol + "//" + location.host;
        let locationMarker;
        let circle;
        let lat = 0.0;
        let lon = 0.0;
        $("#map").css({
            "width": "100%",
            "height": $(document).height() - ($(".site-header").height() + $("#footer").height() + 45)});

        function map_init_basic (map, options) {
            marker = L.marker([53.5, -8.5], 5).addTo(map);
            map.on('updateLatLon', updateLatLon)
        }

        function updateLatLon(latitude,longitude) {
            var lat = latitude;
            var lng = longitude;
            var newLatLng = new L.LatLng(lat, lng);
            marker.setLatLng(newLatLng);
        }

    </script>
{% endblock %}
{% endblock content %}


